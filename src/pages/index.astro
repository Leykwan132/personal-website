---
import { getCollection } from "astro:content";
import { fade } from "astro:transitions";

import Layout from "@/layouts/Layout.astro";
import SocialLinks from "@/components/SocialLinks.astro";
import PostCard from "@/components/PostCard.astro";
import ProjectCard from "@/components/ProjectCard.astro";
import WorkCard from "@/components/WorkCard.astro";
import Link from "@/components/shared/Link.astro";
import convertAsteriskToStrongTag from "@/utils/convertAsteriskToStrongTag";

import presentation from "@/data/presentation";
import projects from "@/data/projects";

const posts = (await getCollection("posts")).sort(function (first, second) {
  return second.data.publishedAt.getTime() - first.data.publishedAt.getTime();
});

const works = await getCollection("works");
---

<Layout>
  <main
    class="flex flex-col gap-20"
    transition:animate={fade({ duration: "0.3s" })}
  >
    <div class="flex flex-col md:flex-row md:justify-between">
      <article
        class="flex flex-col gap-8 md:flex-row-reverse md:justify-end md:gap-12"
      >
        {
          presentation.profile && (
            <img
              src={presentation.profile}
              class="w-1/4 self-center rounded-full"
            />
          )
        }

        <div class="flex flex-col gap-4 md:gap-8">
          <h1 class="text-3xl text-neutral-100">
            {presentation.title}
          </h1>
          <dotlottie-player
            class="my-[-50px] self-center md:hidden"
            autoplay
            loop
            mode="normal"
            src="/anime1.lottie"
            style="width: 300px"
          >
          </dotlottie-player>
          <h2
            class="w-auto max-w-[60ch] leading-6"
            set:html={convertAsteriskToStrongTag(presentation.description)}
          />
          <SocialLinks />
        </div>
      </article>

      <dotlottie-player
        class="mx-[-40px] my-[-50px] hidden md:inline"
        autoplay
        loop
        light
        mode="normal"
        src="/anime1.lottie"
        style="width: 300px"
      >
      </dotlottie-player>
    </div>

    <article class="flex flex-col gap-8">
      <header class="flex w-full flex-row justify-between gap-2">
        <h3 class="text-lg text-neutral-100">My Sharings</h3>
        <Link href="/posts" label="See all" isUnderline target="_self" />
      </header>
      {posts.length === 0 && <p>Soon, stay connected ðŸ‘€...</p>}

      <section class="flex flex-col gap-4 md:flex-row md:flex-wrap">
        {
          posts.length !== 0 &&
            posts
              .slice(0, 2)
              .map((post) => (
                <PostCard
                  publishedAt={post.data.publishedAt}
                  title={post.data.title}
                  description={post.data.description}
                  slug={post.slug}
                />
              ))
        }
      </section>
    </article>

    <article class="flex flex-col gap-8">
      <header class="flex w-full flex-row justify-between gap-2">
        <h3 class="text-lg text-neutral-100">My Work Experiences</h3>
        <Link href="/works" label="See all" isUnderline target="_self" />
      </header>
      {works.length === 0 && <p>Oops, I must work^^^^^</p>}

      <section class="flex flex-col gap-4 md:flex-row md:flex-wrap">
        {
          works.length !== 0 &&
            works
              .slice(0, 2)
              .map((work) => (
                <WorkCard
                  publishedAt={work.data.publishedAt}
                  title={work.data.title}
                  description={work.data.description}
                  slug={work.slug}
                />
              ))
        }
      </section>
    </article>

    <article class="flex flex-col gap-8">
      <header class="flex w-full flex-row justify-between gap-2">
        <h3 class="text-lg text-neutral-100">
          Selected projects ({projects.length})
        </h3>
      </header>
      {projects.length === 0 && <p>Oops, I must work^^^^^</p>}

      <section class="flex flex-col gap-4">
        {
          projects.length !== 0 &&
            projects.map((project) => <ProjectCard {...project} />)
        }
      </section>
    </article>

    <article class="flex flex-col gap-8">
      <header class="flex w-full flex-row justify-between gap-2">
        <h3 class="text-lg text-neutral-100">Get in touch</h3>
      </header>
      <p>
        Email me at <Link
          href={`mailto:${presentation.mail}`}
          label={presentation.mail}
        /> or follow me via my social links.
      </p>

      <SocialLinks />
    </article>
  </main>
</Layout>
